<div class="flex min-h-screen bg-gray-50">
  <!-- Overlay for mobile sidebar -->
  <div *ngIf="isSidebarOpen" class="fixed inset-0 z-20 bg-black bg-opacity-50 md:hidden" (click)="toggleSidebar()"></div>

  <!-- Sidebar -->
  <div class="bg-gradient-to-b from-blue-800 to-indigo-900 text-white w-64 space-y-8 py-7 px-4 fixed inset-y-0 left-0 z-30 transform transition-transform duration-300 ease-in-out shadow-xl"
       [ngClass]="{'translate-x-0': isSidebarOpen, '-translate-x-full': !isSidebarOpen}">
    <!-- Logo and Title -->
    <div class="flex items-center justify-center px-2 border-b border-blue-600 pb-6">
      <div class="bg-white rounded-full p-2 mr-3">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-blue-800" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
        </svg>
      </div>
      <h2 class="text-xl font-bold">Employee Portal</h2>
    </div>

    <!-- Navigation Menu -->
    <nav class="space-y-2">
      <a routerLink="/user" routerLinkActive="bg-blue-700 shadow-lg" class="flex items-center py-3 px-4 rounded-lg transition-all duration-200 hover:bg-blue-700 hover:shadow-md">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" />
        </svg>
        Dashboard
      </a>
      <a routerLink="/user/profile" routerLinkActive="bg-blue-700 shadow-lg" class="flex items-center py-3 px-4 rounded-lg transition-all duration-200 hover:bg-blue-700 hover:shadow-md">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
        </svg>
        Profile
      </a>
        <a routerLink="/user/team" routerLinkActive="bg-blue-700 shadow-lg" class="flex items-center py-3 px-4 rounded-lg transition-all duration-200 hover:bg-blue-700 hover:shadow-md">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z" />
        </svg>
        My Team
      </a>
      
      
      <a routerLink="/user/leave-request" routerLinkActive="bg-blue-700 shadow-lg" class="flex items-center py-3 px-4 rounded-lg transition-all duration-200 hover:bg-blue-700 hover:shadow-md">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
        </svg>
        Leave Request
      </a>
      <a routerLink="/user/attendance-request" routerLinkActive="bg-blue-700 shadow-lg" class="flex items-center py-3 px-4 rounded-lg transition-all duration-200 hover:bg-blue-700 hover:shadow-md">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
        </svg>
        Attendance Request
      </a>
      <button (click)="logout()" class="flex items-center w-full text-left py-3 px-4 rounded-lg transition-all duration-200 hover:bg-red-600 hover:shadow-md mt-8">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1" />
        </svg>
        Logout
      </button>
    </nav>
  </div>

  <!-- Main Content -->
  <div class="flex-1 min-w-0 transition-all duration-300" [ngClass]="{'md:ml-64': isSidebarOpen}">
    <div class="p-6">
      <!-- Header with toggle button -->
      <div class="flex justify-between items-center mb-8">
        <div class="flex items-center">
          <button class="p-2 rounded-lg bg-white shadow-md text-blue-800 hover:bg-blue-50 transition-colors duration-200 mr-4" (click)="toggleSidebar()">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
            </svg>
          </button>
          <div>
            <h2 class="text-3xl font-bold text-gray-800">Employee Dashboard</h2>
            <p class="text-gray-600 mt-1">Welcome to your personal workspace</p>
          </div>
        </div>
        <div class="flex items-center">
          <div class="bg-white rounded-full p-2 shadow-md mr-3">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-blue-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
            </svg>
          </div>
          <span class="text-gray-700 font-medium">{{ user?.FirstName }} {{ user?.LastName }}</span>
        </div>
      </div>

      <!-- Welcome Card -->
      <div class="bg-gradient-to-r from-blue-500 to-blue-600 rounded-xl shadow-lg p-6 text-white mb-8">
        <div class="flex flex-col md:flex-row justify-between items-start md:items-center">
          <div>
            <h3 class="text-2xl font-bold mb-2">Welcome back, {{ user?.FirstName }}!</h3>
            <p class="text-blue-100">Here's your daily overview. You have {{ leaves.length }} leave requests and {{ attendanceRequests.length }} attendance requests.</p>
          </div>
          <div class="flex space-x-3 mt-4 md:mt-0">
            <button *ngIf="canCheckIn()" (click)="checkIn()" 
                    class="bg-white text-blue-600 px-4 py-2 rounded-lg font-medium hover:bg-blue-50 transition-colors duration-200 flex items-center">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
              </svg>
              Check In
            </button>
            <button *ngIf="canCheckOut()" (click)="openCheckOutModal()"
                    class="bg-red-500 text-white px-4 py-2 rounded-lg font-medium hover:bg-red-600 transition-colors duration-200 flex items-center">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
              </svg>
              Check Out
            </button>
          </div>
        </div>
      </div>

      <!-- Stats Cards -->
      <div class="grid grid-cols-1 md:grid-cols-6 gap-6 mb-8">
        <!-- Today's Status -->
        <div class="bg-white p-6 rounded-xl shadow-lg border-l-4 border-blue-500 md:col-span-2">
          <div class="flex justify-between items-center">
            <div>
              <h3 class="text-lg font-semibold text-gray-700">Today's Status</h3>
              <p class="text-3xl font-bold text-gray-800 mt-2" [ngClass]="{
                'text-green-600': getTodayStatus() === 'Checked In' || getTodayStatus() === 'Completed',
                'text-yellow-600': getTodayStatus() === 'Pending',
                'text-red-600': getTodayStatus() === 'Not Checked In'
              }">
                {{ getTodayStatus() }}
              </p>
            </div>
            <div class="bg-blue-100 rounded-full p-3">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-blue-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
              </svg>
            </div>
          </div>
          <p class="text-gray-500 text-sm mt-2">
            {{ getTodayStatusMessage() }}
          </p>
        </div>

        <!-- Pending Leaves -->
        <div class="bg-white p-6 rounded-xl shadow-lg border-l-4 border-yellow-500">
          <div class="flex justify-between items-center">
            <div>
              <h3 class="text-lg font-semibold text-gray-700">Pending Leaves</h3>
              <p class="text-3xl font-bold text-gray-800 mt-2">{{ getPendingLeavesCount() }}</p>
            </div>
            <div class="bg-yellow-100 rounded-full p-3">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-yellow-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
              </svg>
            </div>
          </div>
          <p class="text-gray-500 text-sm mt-2">Awaiting approval</p>
        </div>

        <!-- Approved Leaves -->
        <div class="bg-white p-6 rounded-xl shadow-lg border-l-4 border-green-500">
          <div class="flex justify-between items-center">
            <div>
              <h3 class="text-lg font-semibold text-gray-700">Approved Leaves</h3>
              <p class="text-3xl font-bold text-gray-800 mt-2">{{ getApprovedLeavesCount() }}</p>
            </div>
            <div class="bg-green-100 rounded-full p-3">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-green-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
              </svg>
            </div>
          </div>
          <p class="text-gray-500 text-sm mt-2">Approved requests</p>
        </div>

        <!-- Pending Attendance Requests -->
        <div class="bg-white p-6 rounded-xl shadow-lg border-l-4 border-orange-500">
          <div class="flex justify-between items-center">
            <div>
              <h3 class="text-lg font-semibold text-gray-700">Pending Requests</h3>
              <p class="text-3xl font-bold text-gray-800 mt-2">{{ getPendingAttendanceRequestsCount() }}</p>
            </div>
            <div class="bg-orange-100 rounded-full p-3">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-orange-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
              </svg>
            </div>
          </div>
          <p class="text-gray-500 text-sm mt-2">Attendance requests</p>
        </div>

        <!-- Approved Attendance Requests -->
        <div class="bg-white p-6 rounded-xl shadow-lg border-l-4 border-teal-500">
          <div class="flex justify-between items-center">
            <div>
              <h3 class="text-lg font-semibold text-gray-700">Approved Requests</h3>
              <p class="text-3xl font-bold text-gray-800 mt-2">{{ getApprovedAttendanceRequestsCount() }}</p>
            </div>
            <div class="bg-teal-100 rounded-full p-3">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-teal-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
              </svg>
            </div>
          </div>
          <p class="text-gray-500 text-sm mt-2">Approved attendance requests</p>
        </div>

        <!-- Recent Payroll -->
        <div class="bg-white p-6 rounded-xl shadow-lg border-l-4 border-purple-500">
          <div class="flex justify-between items-center">
            <div>
              <h3 class="text-lg font-semibold text-gray-700">Recent Payroll</h3>
              <p class="text-3xl font-bold text-gray-800 mt-2">{{ getLatestPayroll() | currency }}</p>
            </div>
            <div class="bg-purple-100 rounded-full p-3">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-purple-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
              </svg>
            </div>
          </div>
          <p class="text-gray-500 text-sm mt-2">Net salary from last payroll</p>
        </div>
      </div>

      <!-- Main Content Grid -->
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
        <!-- My Leave Requests Section -->
        <div class="bg-white rounded-xl shadow-lg overflow-hidden">
          <div class="px-6 py-4 border-b border-gray-200 flex justify-between items-center">
            <h3 class="text-xl font-semibold text-gray-800">My Leave Requests</h3>
            <div class="flex items-center space-x-2">
              <span class="text-sm text-gray-500">{{ leaves.length }} requests</span>
              <a routerLink="/user/leave-request" class="text-blue-600 hover:text-blue-800 text-sm font-medium flex items-center">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6" />
                </svg>
                New
              </a>
            </div>
          </div>
          
          <div class="divide-y divide-gray-200 max-h-96 overflow-y-auto">
            <!-- Loading State -->
            <div *ngIf="isLoading.leaves" class="p-8 text-center">
              <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"></div>
              <p class="text-gray-500 mt-2">Loading leaves...</p>
            </div>

            <!-- Empty State -->
            <div *ngIf="!isLoading.leaves && !hasLeaves()" class="p-8 text-center">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 text-gray-400 mx-auto mb-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
              </svg>
              <p class="text-gray-500">No leave requests found.</p>
              <a routerLink="/user/leave-request" class="text-blue-600 hover:text-blue-800 text-sm font-medium mt-2 inline-block">
                Request your first leave →
              </a>
            </div>

            <!-- Leave Items -->
            <div *ngFor="let leave of getRecentLeaves()" class="p-4 hover:bg-gray-50 transition-colors duration-150">
              <div class="flex justify-between items-start mb-3">
                <div class="flex-1">
                  <div class="flex items-center space-x-2 mb-2">
                    <span class="font-medium text-gray-900">{{ leave.TypeName }}</span>
                    <span class="px-2 py-1 text-xs font-medium rounded-full" 
                          [ngClass]="getStatusClass(leave.Status)">
                      {{ leave.Status }}
                    </span>
                  </div>
                  <div class="text-sm text-gray-600">
                    {{ leave.StartDate | date:'mediumDate' }} - {{ leave.EndDate | date:'mediumDate' }}
                    <span class="mx-2">•</span>
                    <span class="font-medium">{{ calculateLeaveDays(leave.StartDate, leave.EndDate) }} days</span>
                  </div>
                </div>
                <div class="flex space-x-2" *ngIf="canEditLeave(leave) || canCancelLeave(leave)">
                  <button *ngIf="canEditLeave(leave)" (click)="openEditLeaveModal(leave)"
                          class="text-blue-600 hover:text-blue-900 bg-blue-50 px-3 py-1 rounded-md hover:bg-blue-100 transition-colors duration-200 text-sm font-medium">
                    Edit
                  </button>
                  <button *ngIf="canCancelLeave(leave)" (click)="openCancelLeaveModal(leave)"
                          class="text-red-600 hover:text-red-900 bg-red-50 px-3 py-1 rounded-md hover:bg-red-100 transition-colors duration-200 text-sm font-medium">
                    Cancel
                  </button>
                </div>
              </div>
              
              <div *ngIf="leave.Reason" class="text-sm text-gray-600 mb-2">
                <span class="font-medium">Reason:</span> {{ leave.Reason }}
              </div>
              
              <div class="flex justify-between items-center text-xs text-gray-500">
                <span>Requested on {{ leave.CreatedDate | date:'mediumDate' }}</span>
                <span *ngIf="leave.ApproverFirstName">
                  Approved by: {{ leave.ApproverFirstName }} {{ leave.ApproverLastName }}
                </span>
              </div>
            </div>
          </div>
          
          <div *ngIf="hasLeaves() && leaves.length > 5" class="px-6 py-4 border-t border-gray-200 bg-gray-50">
            <a routerLink="/user/leave-request" class="text-blue-600 hover:text-blue-800 text-sm font-medium">
              View all {{ leaves.length }} leave requests →
            </a>
          </div>
        </div>

        <!-- My Attendance Requests Section -->
        <div class="bg-white rounded-xl shadow-lg overflow-hidden">
          <div class="px-6 py-4 border-b border-gray-200 flex justify-between items-center">
            <h3 class="text-xl font-semibold text-gray-800">My Attendance Requests</h3>
            <div class="flex items-center space-x-2">
              <span class="text-sm text-gray-500">{{ attendanceRequests.length }} requests</span>
              <a routerLink="/user/attendance-request" class="text-blue-600 hover:text-blue-800 text-sm font-medium flex items-center">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6" />
                </svg>
                New
              </a>
            </div>
          </div>
          
          <div class="divide-y divide-gray-200 max-h-96 overflow-y-auto">
            <!-- Loading State -->
            <div *ngIf="isLoading.attendanceRequests" class="p-8 text-center">
              <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"></div>
              <p class="text-gray-500 mt-2">Loading attendance requests...</p>
            </div>

            <!-- Empty State -->
            <div *ngIf="!isLoading.attendanceRequests && !hasAttendanceRequests()" class="p-8 text-center">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 text-gray-400 mx-auto mb-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
              </svg>
              <p class="text-gray-500">No attendance requests found.</p>
              <a routerLink="/user/attendance-request" class="text-blue-600 hover:text-blue-800 text-sm font-medium mt-2 inline-block">
                Request your first attendance adjustment →
              </a>
            </div>

            <!-- Attendance Request Items -->
            <div *ngFor="let request of getRecentAttendanceRequests()" class="p-4 hover:bg-gray-50 transition-colors duration-150">
              <div class="flex justify-between items-start mb-3">
                <div class="flex-1">
                  <div class="flex items-center space-x-2 mb-2">
                    <span class="font-medium text-gray-900">{{ request.TypeName }}</span>
                    <span class="px-2 py-1 text-xs font-medium rounded-full" 
                          [ngClass]="getStatusClass(request.Status)">
                      {{ request.Status }}
                    </span>
                  </div>
                  <div class="text-sm text-gray-600">
                    {{ request.RequestDate | date:'mediumDate' }}
                    <span *ngIf="requiresTimeInput(request)" class="mx-2">•</span>
                    <span *ngIf="requiresTimeInput(request)" class="font-medium">
                      {{ formatTime(request.StartTime) }} - {{ formatTime(request.EndTime) }}
                    </span>
                  </div>
                </div>
                <div class="flex space-x-2" *ngIf="canEditAttendanceRequest(request) || canCancelAttendanceRequest(request)">
                  <button *ngIf="canEditAttendanceRequest(request)" (click)="openEditAttendanceRequestModal(request)"
                          class="text-blue-600 hover:text-blue-900 bg-blue-50 px-3 py-1 rounded-md hover:bg-blue-100 transition-colors duration-200 text-sm font-medium">
                    Edit
                  </button>
                  <button *ngIf="canCancelAttendanceRequest(request)" (click)="openCancelAttendanceRequestModal(request)"
                          class="text-red-600 hover:text-red-900 bg-red-50 px-3 py-1 rounded-md hover:bg-red-100 transition-colors duration-200 text-sm font-medium">
                    Cancel
                  </button>
                </div>
              </div>
              
              <div *ngIf="request.Reason" class="text-sm text-gray-600 mb-2">
                <span class="font-medium">Reason:</span> {{ request.Reason }}
              </div>
              
              <div class="flex justify-between items-center text-xs text-gray-500">
                <span>Requested on {{ request.CreatedAt | date:'mediumDate' }}</span>
                <span *ngIf="request.ApproverFirstName">
                  Approved by: {{ request.ApproverFirstName }} {{ request.ApproverLastName }}
                </span>
              </div>
            </div>
          </div>
          
          <div *ngIf="hasAttendanceRequests() && attendanceRequests.length > 5" class="px-6 py-4 border-t border-gray-200 bg-gray-50">
            <a routerLink="/user/attendance-request" class="text-blue-600 hover:text-blue-800 text-sm font-medium">
              View all {{ attendanceRequests.length }} attendance requests →
            </a>
          </div>
        </div>
      </div>

      <!-- Recent Attendance Section -->
      <div class="mt-8">
        <div class="bg-white rounded-xl shadow-lg overflow-hidden">
          <div class="px-6 py-4 border-b border-gray-200 flex justify-between items-center">
            <h3 class="text-xl font-semibold text-gray-800">Recent Attendance</h3>
            <span class="text-sm text-gray-500">{{ attendance.length }} records</span>
          </div>
          <div class="divide-y divide-gray-200 max-h-96 overflow-y-auto">
            <!-- Loading State -->
            <div *ngIf="isLoading.attendance" class="p-8 text-center">
              <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"></div>
              <p class="text-gray-500 mt-2">Loading attendance...</p>
            </div>

            <!-- Empty State -->
            <div *ngIf="!isLoading.attendance && attendance.length === 0" class="p-8 text-center">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 text-gray-400 mx-auto mb-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
              </svg>
              <p class="text-gray-500">No attendance records found.</p>
            </div>

            <!-- Attendance Items -->
            <div *ngFor="let att of attendance.slice(0, 5)" class="p-4 hover:bg-gray-50 transition-colors duration-150">
              <div class="flex justify-between items-start">
                <div>
                  <p class="font-medium text-gray-900">{{ att.Date | date:'fullDate' }}</p>
                  <div class="flex items-center mt-2 space-x-4">
                    <span class="text-sm text-gray-600 flex items-center">
                      <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 inline mr-1 text-green-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
                      </svg>
                      In: {{ att.CheckInTime || '--:--' }}
                    </span>
                    <span class="text-sm text-gray-600 flex items-center">
                      <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 inline mr-1 text-red-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
                      </svg>
                      Out: {{ att.CheckOutTime || '--:--' }}
                    </span>
                  </div>
                </div>
                <span class="px-2 py-1 text-xs font-medium rounded-full" 
                      [ngClass]="{
                        'bg-green-100 text-green-800': att.Status === 'Present',
                        'bg-yellow-100 text-yellow-800': att.Status === 'Pending',
                        'bg-red-100 text-red-800': att.Status === 'Absent'
                      }">
                  {{ att.Status }}
                </span>
              </div>
            </div>
          </div>
          <div *ngIf="attendance.length > 5" class="px-6 py-4 border-t border-gray-200 bg-gray-50">
            <a routerLink="/user/attendance" class="text-blue-600 hover:text-blue-800 text-sm font-medium">View all attendance records →</a>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Check Out Confirmation Modal -->
  <div *ngIf="showCheckOutModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
    <div class="bg-white rounded-xl shadow-2xl max-w-md w-full">
      <div class="px-6 py-4 border-b border-gray-200">
        <h3 class="text-xl font-semibold text-gray-800">Confirm Check Out</h3>
      </div>
      <div class="p-6">
        <div class="flex items-center mb-4">
          <div class="flex-shrink-0 h-12 w-12 bg-blue-100 rounded-full flex items-center justify-center mr-4">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-blue-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg>
          </div>
          <div>
            <p class="text-gray-700">Are you sure you want to check out?</p>
            <p class="text-sm text-gray-500 mt-1">You checked in at {{ lastAttendance?.CheckInTime }} today.</p>
          </div>
        </div>
        <div class="flex justify-end space-x-3">
          <button (click)="closeCheckOutModal()" 
                  class="px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50 transition-colors duration-200">
            Cancel
          </button>
          <button (click)="confirmCheckOut()" 
                  class="px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700 transition-colors duration-200">
            Check Out
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Edit Leave Modal -->
  <div *ngIf="showEditLeaveModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
    <div class="bg-white rounded-xl shadow-2xl max-w-md w-full">
      <div class="px-6 py-4 border-b border-gray-200">
        <h3 class="text-xl font-semibold text-gray-800">Edit Leave Request</h3>
      </div>
      <div class="p-6">
        <div class="space-y-4">
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">Leave Type</label>
            <select [(ngModel)]="editLeaveData.LeaveTypeID" 
                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors duration-200">
              <option value="">Select Leave Type</option>
              <option *ngFor="let type of leaveTypes" [value]="type.LeaveTypeID">
                {{ type.TypeName }} (Max: {{ type.MaxDaysPerYear }} days)
              </option>
            </select>
          </div>
          <div class="grid grid-cols-2 gap-4">
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">Start Date</label>
              <input type="date" [(ngModel)]="editLeaveData.StartDate"
                     class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors duration-200">
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">End Date</label>
              <input type="date" [(ngModel)]="editLeaveData.EndDate"
                     class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors duration-200">
            </div>
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">Reason</label>
            <textarea [(ngModel)]="editLeaveData.Reason" rows="3" placeholder="Brief reason for your leave request..."
                      class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors duration-200"></textarea>
          </div>
        </div>
        <div class="flex justify-end space-x-3 mt-6">
          <button (click)="closeEditLeaveModal()" 
                  class="px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50 transition-colors duration-200">
            Cancel
          </button>
          <button (click)="updateLeave()" 
                  class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors duration-200">
            Update Leave
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Cancel Leave Confirmation Modal -->
  <div *ngIf="showCancelLeaveModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
    <div class="bg-white rounded-xl shadow-2xl max-w-md w-full">
      <div class="px-6 py-4 border-b border-gray-200">
        <h3 class="text-xl font-semibold text-gray-800">Cancel Leave Request</h3>
      </div>
      <div class="p-6">
        <div class="flex items-center mb-4">
          <div class="flex-shrink-0 h-12 w-12 bg-red-100 rounded-full flex items-center justify-center mr-4">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-red-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
            </svg>
          </div>
          <div>
            <p class="text-gray-700">Are you sure you want to cancel this leave request?</p>
            <p class="text-sm text-gray-500 mt-1">This action cannot be undone.</p>
          </div>
        </div>
        <div class="flex justify-end space-x-3">
          <button (click)="closeCancelLeaveModal()" 
                  class="px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50 transition-colors duration-200">
            Keep Request
          </button>
          <button (click)="confirmCancelLeave()" 
                  class="px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700 transition-colors duration-200">
            Cancel Leave
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Edit Attendance Request Modal -->
  <div *ngIf="showEditAttendanceRequestModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
    <div class="bg-white rounded-xl shadow-2xl max-w-md w-full">
      <div class="px-6 py-4 border-b border-gray-200">
        <h3 class="text-xl font-semibold text-gray-800">Edit Attendance Request</h3>
      </div>
      <div class="p-6">
        <div class="space-y-4">
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">Request Type</label>
            <select [(ngModel)]="editAttendanceRequestData.RequestTypeID" 
                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors duration-200">
              <option value="">Select Request Type</option>
              <option *ngFor="let type of attendanceRequestTypes" [value]="type.RequestTypeID">
                {{ type.TypeName }}
              </option>
            </select>
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">Request Date</label>
            <input type="date" [(ngModel)]="editAttendanceRequestData.RequestDate"
                   class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors duration-200">
          </div>
          <div class="grid grid-cols-2 gap-4" *ngIf="selectedAttendanceRequest && requiresTimeInput(selectedAttendanceRequest)">
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">Start Time</label>
              <input type="time" [(ngModel)]="editAttendanceRequestData.StartTime"
                     class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors duration-200">
            </div>
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">End Time</label>
              <input type="time" [(ngModel)]="editAttendanceRequestData.EndTime"
                     class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors duration-200">
            </div>
          </div>
          <div>
            <label class="block text-sm font-medium text-gray-700 mb-2">Reason</label>
            <textarea [(ngModel)]="editAttendanceRequestData.Reason" rows="3" placeholder="Brief reason for your request..."
                      class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors duration-200"></textarea>
          </div>
        </div>
        <div class="flex justify-end space-x-3 mt-6">
          <button (click)="closeEditAttendanceRequestModal()" 
                  class="px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50 transition-colors duration-200">
            Cancel
          </button>
          <button (click)="updateAttendanceRequest()" 
                  class="px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors duration-200">
            Update Request
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Cancel Attendance Request Confirmation Modal -->
  <div *ngIf="showCancelAttendanceRequestModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
    <div class="bg-white rounded-xl shadow-2xl max-w-md w-full">
      <div class="px-6 py-4 border-b border-gray-200">
        <h3 class="text-xl font-semibold text-gray-800">Cancel Attendance Request</h3>
      </div>
      <div class="p-6">
        <div class="flex items-center mb-4">
          <div class="flex-shrink-0 h-12 w-12 bg-red-100 rounded-full flex items-center justify-center mr-4">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-red-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
            </svg>
          </div>
          <div>
            <p class="text-gray-700">Are you sure you want to cancel this attendance request?</p>
            <p class="text-sm text-gray-500 mt-1">This action cannot be undone.</p>
          </div>
        </div>
        <div class="flex justify-end space-x-3">
          <button (click)="closeCancelAttendanceRequestModal()" 
                  class="px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50 transition-colors duration-200">
            Keep Request
          </button>
          <button (click)="confirmCancelAttendanceRequest()" 
                  class="px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700 transition-colors duration-200">
            Cancel Request
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Success Modal -->
  <div *ngIf="showSuccessModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
    <div class="bg-white rounded-xl shadow-2xl max-w-md w-full">
      <div class="p-6 text-center">
        <div class="mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-green-100 mb-4">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-green-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
          </svg>
        </div>
        <h3 class="text-lg font-semibold text-gray-800 mb-2">Success!</h3>
        <p class="text-gray-600 mb-6">{{ successMessage }}</p>
        <button (click)="closeSuccessModal()" 
                class="w-full bg-blue-600 text-white py-2 rounded-lg hover:bg-blue-700 transition-colors duration-200 font-medium">
          Continue
        </button>
      </div>
    </div>
  </div>
</div>